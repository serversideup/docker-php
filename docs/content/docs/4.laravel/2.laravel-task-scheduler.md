---
head.title: 'Laravel Task Scheduler with Docker - Docker PHP - Server Side Up'
description: 'Learn how to configure a Laravel Task Scheduler with Docker.'
layout: docs
---

# Laravel Task Scheduler with Docker
Running a Laravel task scheduler with Docker can be a little different from the traditional methods.

## Important concepts
1. If you're using `fpm-apache` or `fpm-nginx`, might need to set the stop signal to `SIGTERM` for a graceful shutdown (see this [PR](https://github.com/serversideup/docker-php/pull/437) for more details why)
1. Be sure to set the health check
1. We will **not** use `cron` to run the scheduler
1. By default `schedule:work` checks every minute, so we will use that to run the system process
1. The actual time trigger itself is set within Laravel

## More detail
We need to run the [schedule:work](https://laravel.com/docs/11.x/scheduling#running-the-scheduler-locally) command from Laravel. Although the docs say "Running the scheduler locally", this is what we want in production. It will run the scheduler in the foreground and execute it every minute. You can configure your Laravel app for the exact time that a command should run through a [scheduled task](https://laravel.com/docs/11.x/scheduling#scheduling-artisan-commands).

## Using cron
Laravel versions prior to 8.x don't have the `schedule:work` command, as [noted by this PR](https://github.com/laravel/framework/pull/34618). This may be also the case for non-Laravel applications that require external scheduling or do not ship with an scheduler process.

A non-invasive alternative is to incorporate the command manually in your application, which basically runs the scheduler each second on a loop.

::codepanel
---
label: A command that runs the Laravel Scheduler
---
```php
namespace App\Console;

use Illuminate\Console\Command;
use Illuminate\Support\Carbon;

class ScheduleWorkCommand extends Command
{
    protected $name = 'schedule:work';
    protected $description = 'Start the schedule worker';

    public function handle()
    {
        $this->info('Starting the Schedule worker.');

        while (true) {
            if (Carbon::now()->second === 0) {
                $this->call('schedule:run');
            }

            sleep(1);
        }
    }
}
```
::

If creating a command is not an alternative, you will need to install `cron`, and add a cron entry to run the Laravel Scheduler each second.

The best place to prepare cron would be in the production image, or before installing your application inside the container. Alpine images use Busybox, which includes `crond` out of the box, so there is no need to install it when using Alpine.

::codepanel
---
label: Installing cron and adding a Laravel Scheduler entry
---
```dockerfile
# ... Prior build steps

# Ensure we're root to install and prepare cron.
USER root

# Install cron on Debian
RUN apt-get update && apt-get -y --no-install-recommends install cron && \
    rm -rf /var/lib/apit/lists/*

# Set Laravel's Scheduler in the container default crontab file running as the "www-data" user
RUN printf "* * * * * www-data php /var/www/html/artisan schedule:run\n" >> /etc/crontab

# Copy our app files as www-data (33:33)
COPY --chown=www-data:www-data . /var/www/html

# Ensure the Cron service (and its PID) runs in the container
RUN chmod gu+s /usr/sbin/cron && \
    chmod gu+rw /var/run

# Ensure next instructions run as the unpriviledged "www-data" user
USER www-data

# Install the application
RUN composer install
```
::

In your Docker Compose file, you will need to call `cron` in the foreground. [On Debian](https://manpages.debian.org/bookworm/cron/cron.8.en.html), this is done with `/usr/sbin/cron -f -L 15`. On Alpine, [BusyBox's `crond`](https://busybox.net/downloads/BusyBox.html#crond) does the job as `/usr/sbin/crond -f -l 0`. Both of these commands will run the process with verbose output.

::code-panel
---
label: Calling the Laravel Scheduler through cron in Docker Compose File
---
```yaml
services:
  php:
    image: myself/laravel-app
    environment:
      PHP_FPM_POOL_NAME: "my-app_php"

  task:
    image: myself/laravel-app
    command: ["/usr/sbin/cron", "-f", "-L", "15"]
    environment:
      PHP_FPM_POOL_NAME: "my-app_task"
```
::

## Examples
Here is a simplified example of how you can achieve this with Docker Compose:

::note
Notice we're calling the artisan command explicitly with the full path (`/var/www/html/artisan`). This is because we need to run the command from the context of the container.
::

::code-panel
---
label: Example & Simplified Docker Compose File
---
```yaml
services:
  php:
    image: my/laravel-app

  task:
    image: my/laravel-app
    command: ["php", "/var/www/html/artisan", "schedule:work"]
    stop_signal: SIGTERM # Set this for graceful shutdown if you're using fpm-apache or fpm-nginx
    healthcheck:
      # This is our native healthcheck script for the scheduler
      test: ["CMD", "healthcheck-schedule"]
      start_period: 10s
```
::


This is an example how we would set the actual execution time within Laravel itself:

::code-panel
---
label: Example in Laravel (version <= 10) using `Kernel.php`
---
```php
<?php

namespace App\Console;

use Illuminate\Console\Scheduling\Schedule;
use Illuminate\Foundation\Console\Kernel as ConsoleKernel;

class Kernel extends ConsoleKernel
{
    /**
     * The Artisan commands provided by your application.
     *
     * @var array
     */
    protected $commands = [
        //
    ];

    /**
     * Define the application's command schedule.
     *
     * @param  \Illuminate\Console\Scheduling\Schedule  $schedule
     * @return void
     */
    protected function schedule(Schedule $schedule)
    {
        $schedule->command('process:invoices')->daily()->at('02:00')->timezone('America/Chicago');
        $schedule->command('process:latefees')->daily()->at('04:00')->timezone('America/Chicago');
    }

    /**
     * Register the commands for the application.
     *
     * @return void
     */
    protected function commands()
    {
        $this->load(__DIR__.'/Commands');

        require base_path('routes/console.php');
    }
}
```
::

::code-panel
---
label: Example in Laravel (version >= 11) using `routes/console.php`
---
```php
<?php
 
use Illuminate\Support\Facades\DB;
use Illuminate\Support\Facades\Schedule;
 
Schedule::call(function () {
    DB::table('recent_users')->delete();
})->daily()->at('04:00')->timezone('America/Chicago');
```
::

## Get Up and Running The Easy Way
We do all the heavy lifting for you with Spin Pro. It's as easy as selecting it in a menu and we'll configure everything else for you. Learn how easy it is to get up and running with the Task Scheduler on Spin Pro.

[Learn more about Laravel Task Scheduler + Spin Pro â†’](https://getspin.pro/docs/services/laravel-scheduler)
