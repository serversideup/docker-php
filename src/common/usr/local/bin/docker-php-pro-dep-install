#!/bin/sh
set -ouex

###################################################
# Usage: docker-php-pro-dep-install [packages]
###################################################
# This script detects the OS and installs the packages passed in as arguments.

if [ "$#" -eq 0 ]; then
    echo "üîî WARNING: No packages were passed to this script. Continuing without installing additional packages."
    exit 0
fi

DEP_PACKAGES="$@"

# Convert comma-delimited package names to space-separated
DEP_PACKAGES="$(echo $DEP_PACKAGES | tr ',' ' ')"

# Determine the Operating System
if [ -f /etc/os-release ]; then
    # Source the os-release file (including the $NAME variable)
    . /etc/os-release
else
    echo "Unable to determine the OS."
    exit 1
fi

# Installation commands and clean-up processes based on OS
case $NAME in
    "Debian GNU/Linux")
        INSTALL_CMD="(apt-get update && apt-get install -y $DEP_PACKAGES)"
        CLEANUP_CMD="(apt-get clean && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*)"
        ;;
    "Alpine Linux")
        INSTALL_CMD="(apk update && apk add --no-cache $DEP_PACKAGES)"
        CLEANUP_CMD="rm -rf /var/cache/apk/*"
        ;;
    *)
        echo "Unsupported OS: $NAME"
        exit 1
        ;;
esac

# Execute Installation & Cleanup
eval $INSTALL_CMD
eval $CLEANUP_CMD
echo "‚ö°Ô∏è Completed installation of: $DEP_PACKAGES"