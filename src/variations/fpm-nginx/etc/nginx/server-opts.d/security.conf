##
# Security Configuration
##

# This configuration follows security best practices from:
#
#   H5BP Server Configs (nginx)
#   https://github.com/h5bp/server-configs-nginx
#
#   OWASP Secure Headers Project
#   https://owasp.org/www-project-secure-headers/
#
#   RFC 8615 - Well-Known URIs
#   https://www.rfc-editor.org/rfc/rfc8615
#
# ##############################################################################

# Prevent clickjacking attacks by disabling iframe embedding
# https://owasp.org/www-project-secure-headers/#x-frame-options
add_header X-Frame-Options           "SAMEORIGIN" always;

# Prevent MIME type sniffing attacks
# https://owasp.org/www-project-secure-headers/#x-content-type-options
add_header X-Content-Type-Options    "nosniff" always;

# Control referrer information sent with requests
# https://owasp.org/www-project-secure-headers/#referrer-policy
add_header Referrer-Policy           "strict-origin-when-cross-origin" always;

# Enable HTTP Strict Transport Security (HSTS)
# https://owasp.org/www-project-secure-headers/#strict-transport-security
add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;

# ------------------------------------------------------------------------------
# | File Access Restrictions                                                   |
# ------------------------------------------------------------------------------

# Block access to hidden files and directories (dotfiles)
# EXCEPT for the "/.well-known/" directory which is required by RFC 8615
# for ACME challenges, security.txt, and other standardized endpoints.
# https://www.rfc-editor.org/rfc/rfc8615
# https://github.com/h5bp/server-configs-nginx
location ~ /\.(?!well-known) {
    deny all;
}

# Block access to files that may expose sensitive information
# Based on H5BP server configs: https://github.com/h5bp/server-configs-nginx
location ~* (?:#.*#|\.(?:bak|conf|config|dist|inc|ini|log|sh|sql|sw[op])|~)$ {
    deny all;
}